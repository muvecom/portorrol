<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Portorrol Monitor IA</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary-color: #1e40af;
            --secondary-color: #3b82f6;
            --neutral-color: #f8fafc;
            --border-color: #e2e8f0;
            --text-color: #1e293b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo-placeholder {
            width: 180px;
            height: 70px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logo-placeholder:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(30, 64, 175, 0.3);
        }
        
        .header-title h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 4px;
        }
        
        .header-title p {
            color: #64748b;
            font-size: 14px;
        }
        
        .filters-container {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-select {
            padding: 10px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 14px;
            min-width: 180px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: #64748b;
        }
        
        .btn-outline:hover {
            background: var(--neutral-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        /* Chart Containers */
        .chart-container {
            position: relative;
            height: 280px;
            width: 100%;
            margin: 10px 0;
        }
        
        .small-chart {
            height: 200px;
        }
        
        /* Sentiment Styles */
        .sentiment-legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .sentiment-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .sentiment-positive { background-color: var(--success-color); }
        .sentiment-neutral { background-color: var(--warning-color); }
        .sentiment-negative { background-color: var(--danger-color); }
        
        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .product-item {
            background: var(--neutral-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .product-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Objections Grid */
        .objections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .objection-card {
            background: var(--neutral-color);
            border-radius: 8px;
            padding: 16px;
        }
        
        .objection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .objection-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .objection-percentage {
            font-size: 16px;
            font-weight: 700;
        }
        
        .percentage-positive { color: var(--success-color); }
        .percentage-negative { color: var(--danger-color); }
        
        .percentage-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .percentage-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .fill-positive { background: var(--success-color); }
        .fill-negative { background: #cbd5e1; }
        
        .percentage-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #64748b;
        }
        
        /* Conversations Table */
        .conversations-table-container {
            overflow-x: auto;
        }
        
        .conversations-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .conversations-table th {
            background: var(--neutral-color);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #64748b;
            border-bottom: 2px solid var(--border-color);
        }
        
        .conversations-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }
        
        .conversations-table tr:hover {
            background: #f8fafc;
        }
        
        .sentiment-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .pagination-info {
            font-size: 14px;
            color: #64748b;
        }
        
        .pagination-controls {
            display: flex;
            gap: 8px;
        }
        
        .pagination-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 16px;
            color: #64748b;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filters-container {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            .card {
                padding: 16px;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .filter-select {
                min-width: 140px;
            }
        }
        
        @media (max-width: 480px) {
            .filters-container {
                flex-direction: column;
            }
            
            .filter-select {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <div class="logo-placeholder" id="logo-placeholder">
                    PORTORROL<br>
                    <small>Rolamentos Industriais</small>
                </div>
                <div class="header-title">
                    <h1>Monitor IA - Dashboard</h1>
                    <p>Análise de atendimento e desempenho comercial</p>
                </div>
            </div>
            <div class="filters-container">
                <div class="filter-group">
                    <label class="filter-label">Período</label>
                    <select class="filter-select" id="period-filter">
                        <option value="7">Últimos 7 dias</option>
                        <option value="30" selected>Últimos 30 dias</option>
                        <option value="90">Últimos 90 dias</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Atendente</label>
                    <select class="filter-select" id="attendant-filter">
                        <option value="all">Todos os Atendentes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Objeção</label>
                    <select class="filter-select" id="objection-filter">
                        <option value="all">Todas as Objeções</option>
                        <option value="highPrice">Preço Elevado</option>
                        <option value="deliveryTime">Prazo de Entrega</option>
                        <option value="productQuality">Qualidade</option>
                        <option value="availability">Disponibilidade</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Sentimento</label>
                    <select class="filter-select" id="sentiment-filter">
                        <option value="all">Todos os Sentimentos</option>
                        <option value="positive">Positivo</option>
                        <option value="neutral">Neutro</option>
                        <option value="negative">Negativo</option>
                    </select>
                </div>
            </div>
        </header>
        
        <div class="stats-grid">
            <!-- Card de Transição de Sentimento -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Transição de Sentimento</div>
                    <div class="card-actions">
                        <button class="btn btn-outline" onclick="downloadChart('sentimentTransitionChart')">Exportar</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="sentimentTransitionChart"></canvas>
                </div>
                <div class="sentiment-legend">
                    <div class="legend-item">
                        <div class="sentiment-dot sentiment-positive"></div>
                        <span>Positivo</span>
                    </div>
                    <div class="legend-item">
                        <div class="sentiment-dot sentiment-neutral"></div>
                        <span>Neutro</span>
                    </div>
                    <div class="legend-item">
                        <div class="sentiment-dot sentiment-negative"></div>
                        <span>Negativo</span>
                    </div>
                </div>
            </div>
            
            <!-- Card de Distribuição do Sentimento -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Sentimento Final</div>
                    <div class="card-actions">
                        <button class="btn btn-outline" onclick="downloadChart('sentimentDistributionChart')">Exportar</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="sentimentDistributionChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="stats-grid">
            <!-- Card de Top Objeções -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Top 3 Objeções</div>
                    <div class="card-actions">
                        <button class="btn btn-outline" onclick="downloadChart('objectionsChart')">Exportar</button>
                    </div>
                </div>
                <div class="chart-container small-chart">
                    <canvas id="objectionsChart"></canvas>
                </div>
            </div>
            
            <!-- Card de Top Produtos -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Top 3 Produtos</div>
                    <div class="card-actions">
                        <button class="btn btn-outline" onclick="downloadChart('productsChart')">Exportar</button>
                    </div>
                </div>
                <div class="chart-container small-chart">
                    <canvas id="productsChart"></canvas>
                </div>
            </div>
            
            <!-- Card de Análise de Atendentes -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Desempenho dos Atendentes</div>
                    <div class="card-actions">
                        <button class="btn btn-outline" onclick="downloadChart('attendantAnalysisChart')">Exportar</button>
                    </div>
                </div>
                <div class="chart-container small-chart">
                    <canvas id="attendantAnalysisChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Seção de Produtos Mais Buscados -->
        <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">
                <div class="card-title">Produtos Mais Buscados</div>
            </div>
            <div class="products-grid" id="popular-products">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>
        </div>
        
        <!-- Seção de Objeções Detalhadas -->
        <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">
                <div class="card-title">Análise de Objeções</div>
            </div>
            <div class="objections-grid" id="objections-detailed">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>
        </div>
        
        <!-- Seção de Resumo das Conversas -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Resumo das Conversas</div>
            </div>
            <div class="conversations-table-container">
                <table class="conversations-table">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Cliente</th>
                            <th>Atendente</th>
                            <th>Resumo</th>
                            <th>Sentimento</th>
                            <th>Duração</th>
                        </tr>
                    </thead>
                    <tbody id="conversations-body">
                        <!-- Conteúdo será preenchido dinamicamente -->
                    </tbody>
                </table>
            </div>
            <div class="pagination">
                <div class="pagination-info" id="pagination-info">Carregando...</div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="prev-page" disabled>Anterior</button>
                    <button class="pagination-btn" id="next-page" disabled>Próxima</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados de exemplo adaptados para rolamentos industriais
        const sampleData = {
            "totalConversations": 847,
            "sentimentTransitions": [
                {"from": "neutral", "to": "neutral", "count": 420},
                {"from": "positive", "to": "neutral", "count": 185},
                {"from": "positive", "to": "positive", "count": 89},
                {"from": "neutral", "to": "positive", "count": 98},
                {"from": "neutral", "to": "negative", "count": 45},
                {"from": "negative", "to": "negative", "count": 28},
                {"from": "positive", "to": "negative", "count": 12}
            ],
            "finalSentiment": {
                "positive": 187,
                "neutral": 645,
                "negative": 15
            },
            "topObjections": [
                {"objection": "Preço Elevado", "count": 156},
                {"objection": "Prazo de Entrega", "count": 89},
                {"objection": "Disponibilidade", "count": 67}
            ],
            "topProducts": [
                {"product": "Rolamento AXK 2035", "count": 234},
                {"product": "Rolamento SKF 6308", "count": 189},
                {"product": "Rolamento FAG 6205", "count": 156}
            ],
            "attendantAnalysis": [
                {"attendant": "João Silva", "technical": 88, "persuasion": 82, "conversionRate": 68, "totalConversations": 145},
                {"attendant": "Maria Santos", "technical": 92, "persuasion": 85, "conversionRate": 72, "totalConversations": 132},
                {"attendant": "Pedro Costa", "technical": 79, "persuasion": 76, "conversionRate": 61, "totalConversations": 118},
                {"attendant": "Ana Oliveira", "technical": 85, "persuasion": 81, "conversionRate": 65, "totalConversations": 127}
            ],
            "popularProducts": [
                "Rolamento AXK 2035", "Rolamento SKF 6308", "Rolamento FAG 6205", 
                "Rolamento NSK 6006", "Rolamento TIMKEN 30210", "Rolamento Roda Industrial",
                "Rolamento de Esferas", "Rolamento de Rolos", "Rolamento de Agulhas",
                "Rolamento AXK 2542", "Rolamento SKF 6310", "Rolamento FAG 6309"
            ],
            "objections": {
                "highPrice": {"yes": 24, "no": 76},
                "deliveryTime": {"yes": 18, "no": 82},
                "productQuality": {"yes": 8, "no": 92},
                "availability": {"yes": 15, "no": 85}
            },
            "conversations": [
                {
                    "date": "10/10/2024 14:30",
                    "session": "9a5088b1-fbbc-4364-8511-8c8f53898686",
                    "summary": "Cliente da empresa LITORAL interessado em rolamentos AXK para equipamento industrial. Solicitou orçamento urgente.",
                    "sentiment": {"from": "positive", "to": "positive"},
                    "attendantName": "João Silva",
                    "contactName": "Eduardo Amorim",
                    "duration": 1066
                },
                {
                    "date": "10/10/2024 13:15",
                    "session": "c54d22dd-f84e-49e4-b69c-6def4495085f",
                    "summary": "Cliente CAMPANELLI consultou sobre disponibilidade de rolamentos SKF 6308. Objeção: prazo de entrega.",
                    "sentiment": {"from": "neutral", "to": "negative"},
                    "attendantName": "Maria Santos",
                    "contactName": "Lucas Campanelli",
                    "duration": 115250
                },
                {
                    "date": "10/10/2024 11:45",
                    "session": "cdd28587-9b1c-47b6-b9e8-7de84a4a634e",
                    "summary": "Empresa RENOVOMAQ solicitou catálogo completo de rolamentos industriais para reposição de estoque.",
                    "sentiment": {"from": "neutral", "to": "positive"},
                    "attendantName": "Pedro Costa",
                    "contactName": "Renovomaq",
                    "duration": 102589
                }
            ],
            "attendants": [
                { "id": "5ddfc13f-2c7f-4e8c-b9d1-55ece9147cbb", "name": "João Silva" },
                { "id": "fa1eecef-571d-4653-9688-abf9d7e64f96", "name": "Maria Santos" },
                { "id": "0bac9236-fcd5-4e55-b796-b8deadec3179", "name": "Pedro Costa" },
                { "id": "a186e053-6ba3-4d4b-88e8-46f7fba109ff", "name": "Ana Oliveira" }
            ],
            "pagination": {
                "currentPage": 1,
                "totalPages": 9,
                "itemsPerPage": 100,
                "totalItems": 847
            }
        };

        // Variáveis globais
        let currentData = {};
        let currentFilters = {
            period: '30',
            attendant: 'all',
            objection: 'all',
            sentiment: 'all'
        };

        // Função para renderizar o gráfico de transição de sentimento
        function renderSentimentTransitionChart(data) {
            const ctx = document.getElementById('sentimentTransitionChart').getContext('2d');
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('Dados de transição de sentimento inválidos');
                data = sampleData.sentimentTransitions;
            }
            
            const labels = data.map(item => {
                const fromText = item.from === 'positive' ? 'Positivo' : item.from === 'neutral' ? 'Neutro' : 'Negativo';
                const toText = item.to === 'positive' ? 'Positivo' : item.to === 'neutral' ? 'Neutro' : 'Negativo';
                return `${fromText} → ${toText}`;
            });
            
            const counts = data.map(item => item.count);
            const total = counts.reduce((sum, count) => sum + count, 0);
            
            const backgroundColors = data.map(item => {
                if (item.from === 'positive' && item.to === 'positive') return '#10b981';
                if (item.from === 'neutral' && item.to === 'neutral') return '#f59e0b';
                if (item.from === 'negative' && item.to === 'negative') return '#ef4444';
                if (item.from === 'positive' && item.to === 'negative') return '#f87171';
                if (item.from === 'negative' && item.to === 'positive') return '#86efac';
                return '#94a3b8';
            });

            if (window.sentimentTransitionChart) {
                window.sentimentTransitionChart.destroy();
            }

            window.sentimentTransitionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    onClick: (evt, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const transition = data[index];
                            alert(`Detalhes da transição:\n${labels[index]}\nQuantidade: ${counts[index]} conversas\n\nClique em "Filtrar por Atendente" para ver detalhes específicos.`);
                        }
                    }
                }
            });
        }

        // Função para renderizar o gráfico de distribuição de sentimento
        function renderSentimentDistributionChart(data) {
            const ctx = document.getElementById('sentimentDistributionChart').getContext('2d');
            
            if (!data || typeof data !== 'object') {
                console.warn('Dados de distribuição de sentimento inválidos');
                data = sampleData.finalSentiment;
            }
            
            const labels = ['Positivo', 'Neutro', 'Negativo'];
            const counts = [data.positive || 0, data.neutral || 0, data.negative || 0];
            const total = counts.reduce((sum, count) => sum + count, 0);
            
            const backgroundColors = ['#10b981', '#f59e0b', '#ef4444'];

            if (window.sentimentDistributionChart) {
                window.sentimentDistributionChart.destroy();
            }

            window.sentimentDistributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Função para renderizar o gráfico de objeções
        function renderObjectionsChart(data) {
            const ctx = document.getElementById('objectionsChart').getContext('2d');
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('Dados de objeções inválidos');
                data = sampleData.topObjections;
            }
            
            const labels = data.map(item => item.objection);
            const counts = data.map(item => item.count);
            const total = counts.reduce((sum, count) => sum + count, 0);
            
            const backgroundColors = ['#3b82f6', '#60a5fa', '#93c5fd'];

            if (window.objectionsChart) {
                window.objectionsChart.destroy();
            }

            window.objectionsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors,
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw || 0;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `Quantidade: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // Função para renderizar o gráfico de produtos
        function renderProductsChart(data) {
            const ctx = document.getElementById('productsChart').getContext('2d');
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('Dados de produtos inválidos');
                data = sampleData.topProducts;
            }
            
            const labels = data.map(item => item.product);
            const counts = data.map(item => item.count);
            const total = counts.reduce((sum, count) => sum + count, 0);
            
            const backgroundColors = ['#8b5cf6', '#a78bfa', '#c4b5fd'];

            if (window.productsChart) {
                window.productsChart.destroy();
            }

            window.productsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: backgroundColors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 10,
                                padding: 10,
                                font: {
                                    size: 10
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Função para renderizar a análise de atendentes
        function renderAttendantAnalysisChart(data) {
            const ctx = document.getElementById('attendantAnalysisChart').getContext('2d');
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('Dados de análise de atendentes inválidos');
                data = sampleData.attendantAnalysis;
            }
            
            const labels = data.map(item => item.attendant);
            const technicalData = data.map(item => item.technical);
            const persuasionData = data.map(item => item.persuasion);

            if (window.attendantAnalysisChart) {
                window.attendantAnalysisChart.destroy();
            }

            window.attendantAnalysisChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Conhecimento Técnico', 'Capacidade de Persuasão', 'Taxa de Conversão'],
                    datasets: data.map((item, index) => ({
                        label: item.attendant,
                        data: [item.technical, item.persuasion, item.conversionRate],
                        backgroundColor: `rgba(${59 + index * 50}, ${130 + index * 30}, ${246 - index * 40}, 0.2)`,
                        borderColor: `rgb(${59 + index * 50}, ${130 + index * 30}, ${246 - index * 40})`,
                        borderWidth: 2,
                        pointBackgroundColor: `rgb(${59 + index * 50}, ${130 + index * 30}, ${246 - index * 40})`
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: {
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 10,
                                padding: 10,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }

        // Função para renderizar produtos mais buscados
        function renderPopularProducts(data) {
            const container = document.getElementById('popular-products');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('Dados de produtos populares inválidos');
                data = sampleData.popularProducts;
            }
            
            data.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.textContent = product;
                container.appendChild(productItem);
            });
        }

        // Função para renderizar objeções detalhadas
        function renderObjectionsDetailed(data) {
            const container = document.getElementById('objections-detailed');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!data || typeof data !== 'object') {
                console.warn('Dados de objeções detalhadas inválidos');
                data = sampleData.objections;
            }
            
            const objectionTitles = {
                'highPrice': 'Preço Elevado',
                'deliveryTime': 'Prazo de Entrega',
                'productQuality': 'Qualidade do Produto',
                'availability': 'Disponibilidade'
            };
            
            Object.entries(data).forEach(([key, value]) => {
                const objectionCard = document.createElement('div');
                objectionCard.className = 'objection-card';
                
                const yesPercentage = value.yes || 0;
                const noPercentage = value.no || 100;
                
                objectionCard.innerHTML = `
                    <div class="objection-header">
                        <div class="objection-title">${objectionTitles[key] || key}</div>
                        <div class="objection-percentage percentage-positive">${yesPercentage}%</div>
                    </div>
                    <div class="percentage-bar">
                        <div class="percentage-fill fill-positive" style="width: ${yesPercentage}%"></div>
                    </div>
                    <div class="percentage-labels">
                        <span>Sim: ${yesPercentage}%</span>
                        <span>Não: ${noPercentage}%</span>
                    </div>
                `;
                
                container.appendChild(objectionCard);
            });
        }

        // Função para renderizar conversas
        function renderConversations(data) {
            const container = document.getElementById('conversations-body');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('Dados de conversas inválidos');
                data = sampleData.conversations;
            }
            
            data.forEach(conversation => {
                const row = document.createElement('tr');
                
                const fromClass = `sentiment-${conversation.sentiment.from}`;
                const toClass = `sentiment-${conversation.sentiment.to}`;
                
                const durationMinutes = Math.floor(conversation.duration / 60);
                const durationSeconds = conversation.duration % 60;
                const durationText = `${durationMinutes}min ${durationSeconds}s`;
                
                row.innerHTML = `
                    <td>${conversation.date}</td>
                    <td>${conversation.contactName || 'Cliente'}</td>
                    <td>${conversation.attendantName || 'Atendente'}</td>
                    <td>${conversation.summary}</td>
                    <td>
                        <div class="sentiment-indicator">
                            <div class="sentiment-dot ${fromClass}"></div>
                            <span>→</span>
                            <div class="sentiment-dot ${toClass}"></div>
                        </div>
                    </td>
                    <td>${durationText}</td>
                `;
                
                container.appendChild(row);
            });
        }

        // Função para renderizar informações de paginação
        function renderPagination(data) {
            const infoContainer = document.getElementById('pagination-info');
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            
            if (!data || !infoContainer) return;
            
            const startItem = (data.currentPage - 1) * data.itemsPerPage + 1;
            const endItem = Math.min(data.currentPage * data.itemsPerPage, data.totalItems);
            
            infoContainer.textContent = `${startItem} - ${endItem} de ${data.totalItems} conversas`;
            
            prevBtn.disabled = data.currentPage <= 1;
            nextBtn.disabled = data.currentPage >= data.totalPages;
        }

        // Função para carregar atendentes no filtro
        function loadAttendantsFilter(attendants) {
            const filter = document.getElementById('attendant-filter');
            if (!filter) return;
            
            // Limpar opções existentes (exceto "Todos")
            while (filter.children.length > 1) {
                filter.removeChild(filter.lastChild);
            }
            
            if (attendants && Array.isArray(attendants)) {
                attendants.forEach(attendant => {
                    const option = document.createElement('option');
                    option.value = attendant.id;
                    option.textContent = attendant.name;
                    filter.appendChild(option);
                });
            }
        }

        // Função para aplicar filtros
        function applyFilters() {
            console.log('Aplicando filtros:', currentFilters);
            // Aqui você implementaria a lógica para filtrar os dados
            // Por enquanto, vamos apenas recarregar os dados
            loadDataFromWebhook();
        }

        // Função para carregar dados do webhook
        async function loadDataFromWebhook() {
            showLoadingState();
            
            try {
                // Substitua esta URL pela URL do seu webhook
                const response = await fetch('https://api.muvecom.com.br/v1/71ae25a3-1d51-4e4a-91d6-aa90a23ae42b');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data) {
                    throw new Error('Resposta vazia do servidor');
                }
                
                currentData = data;
                renderAllComponents(data);
                
            } catch (error) {
                console.error('Erro ao carregar dados do webhook:', error);
                useSampleData();
            }
        }

        // Função para usar dados de exemplo
        function useSampleData() {
            console.log('Usando dados de exemplo');
            currentData = sampleData;
            renderAllComponents(sampleData);
        }

        // Função para renderizar todos os componentes
        function renderAllComponents(data) {
            renderSentimentTransitionChart(data.sentimentTransitions);
            renderSentimentDistributionChart(data.finalSentiment);
            renderObjectionsChart(data.topObjections);
            renderProductsChart(data.topProducts);
            renderAttendantAnalysisChart(data.attendantAnalysis);
            renderPopularProducts(data.popularProducts);
            renderObjectionsDetailed(data.objections);
            renderConversations(data.conversations);
            renderPagination(data.pagination);
            loadAttendantsFilter(data.attendants);
            
            hideLoadingState();
        }

        // Função para mostrar estado de carregamento
        function showLoadingState() {
            // Implementar visual de carregamento se necessário
        }

        // Função para esconder estado de carregamento
        function hideLoadingState() {
            // Implementar fim do visual de carregamento se necessário
        }

        // Função para baixar gráfico
        function downloadChart(chartId) {
            const chart = window[chartId];
            if (chart) {
                const link = document.createElement('a');
                link.download = `${chartId}-${new Date().toISOString().split('T')[0]}.png`;
                link.href = chart.toBase64Image();
                link.click();
            }
        }

        // Função para carregar logo
        function loadLogo() {
            const logoPlaceholder = document.getElementById('logo-placeholder');
            
            const logoUrl = "https://portal.portorrol.com.br/imagens/logo.png";
            
            if (logoUrl) {
                logoPlaceholder.innerHTML = `<img src="${logoUrl}" alt="Logo Portorrol" style="max-width: 100%; max-height: 100%; border-radius: 6px;">`;
            } else {
                logoPlaceholder.addEventListener('click', function() {
                    const url = prompt('Insira a URL da logo da Portorrol:');
                    if (url) {
                        localStorage.setItem('portorrol-logo-url', url);
                        logoPlaceholder.innerHTML = `<img src="${url}" alt="Logo Portorrol" style="max-width: 100%; max-height: 100%; border-radius: 6px;">`;
                    }
                });
            }
        }

        // Configurar eventos de filtro
        function setupFilterEvents() {
            document.getElementById('period-filter').addEventListener('change', function(e) {
                currentFilters.period = e.target.value;
                applyFilters();
            });
            
            document.getElementById('attendant-filter').addEventListener('change', function(e) {
                currentFilters.attendant = e.target.value;
                applyFilters();
            });
            
            document.getElementById('objection-filter').addEventListener('change', function(e) {
                currentFilters.objection = e.target.value;
                applyFilters();
            });
            
            document.getElementById('sentiment-filter').addEventListener('change', function(e) {
                currentFilters.sentiment = e.target.value;
                applyFilters();
            });
            
            document.getElementById('prev-page').addEventListener('click', function() {
                if (currentData.pagination && currentData.pagination.currentPage > 1) {
                    console.log('Carregar página anterior');
                    // Implementar carregamento da página anterior
                }
            });
            
            document.getElementById('next-page').addEventListener('click', function() {
                if (currentData.pagination && currentData.pagination.currentPage < currentData.pagination.totalPages) {
                    console.log('Carregar próxima página');
                    // Implementar carregamento da próxima página
                }
            });
        }

        // Inicializar a página
        document.addEventListener('DOMContentLoaded', function() {
            loadLogo();
            setupFilterEvents();
            loadDataFromWebhook();
        });
    </script>
</body>
</html>
